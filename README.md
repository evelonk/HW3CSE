# HW3 — Микросервисная система проверки работ на плагиат
Данный проект представляет собой микросервисную архитектуру для загрузки студенческих работ, их хранения, автоматического анализа на плагиат и предоставления итоговых отчётов.
Все сервисы контейнеризованы в docker и взаимодействуют через HTTP API

## Инструкция по запуску
Клонировать, сбилдить, запустить
```
  git clone https://github.com/evelonk/HW3CSE.git
  cd HW3CSE
  docker compose up --build
  ```
**API Gateway:** http://localhost:8085/swagger
## Архитектура

Система состоит из трёх независимых микросервисов
```
API Gateway  
   │  
   ▼  
FileStorageService  
   │  — принимает загруженный файл
   │  — сохраняет файл в S3-хранилище (MinIO)
   │  — сохраняет метаданные в PostgreSQL (FileStorage DB)
   │  — автоматически вызывает анализ файла
   ▼  
FileAnalysisService  
   │  — скачивает файл из FileStorageService
   │  — сравнивает с другими работами по тому же заданию
   │  — вычисляет процент сходства
   │  — определяет факт плагиата (>= 70%)
   │  — формирует отчёт
   ▼  
PostgreSQL (Analysis DB)  
   — хранит все отчёты анализа

```

### Технологии 

1. ASP.NET Core 8
2. PostgreSQL
3. MinIO (S3)
4. Docker
5. Swagger

## Описание микросервисов
## FileStorageService
Отвечает за:

- приём загруженных файлов

- сохранение метаданных в PostgreSQL

- сохранение файлов в S3-хранилище (MinIO)

- автоматический запуск анализа через HTTP-запрос

## FileAnalysisService

Отвечает за:

- скачивание файла из FileStorageService

- сравнение с другими файлами по той же контрольной

- определение процента сходства

- решение: плагиат / не плагиат

- сохранение отчёта в свою БД

### Что сравнивается:

только работы по одному и тому же заданию, исключая саму проверяемую работу

### API Gateway

Единая точка входа для клиента, предоставляет публичный API:
```
POST /works                       — загрузить работу
GET  /works/{id}/download         — скачать файл
GET  /works/{assignment}/reports  — получить отчёты по заданию
GET  /works/files/{id}/reports    — получить отчёты по файлу
```

## Алгоритм анализа на плагиат
1. FileStorageService сохраняет файл и сразу вызывает:
   ```
   POST /api/analysis/check/{fileId}
    ```
2. FileAnalysisService:

    - скачивает сравниваемый файл
    
    - находит все файлы с тем же AssignmentName
    
    - сравнивает каждый из них побайтово
    
    - вычисляет процент совпадения
3. Порог плагиата - 70%, после превышения соответствующее поле становится true
4. Создается итоговый отчет:
   ```
   "checkedFileId": "...",
    "matchedFileId": "...",
    "maxSimilarityPercent": 100,
    "isPlagiarism": true,
    "studentName": "Имя",
    "assignmentName": "Название работы",
    "checkedAt": "Дата"  
    ```
# Docker
Проект разворачивает:

- 2 PostgreSQL базы

- MinIO для хранения файлов

- 3 dotnet контейнера

Все зависимости прописаны в docker-compose.yml

Обработка ошибок через try catch, если какой-то микросервис падает, то при запросе будет текст **в данный момент этот сервис недоступен**

## То есть работа по шагам
1. Клиент загружает файл
2. FileStorageService сохраняет файл, записывает в бд, вызывает анализ
3. FileAnalysisService сравнивает эту работу с предыдущими по названию задания, создает отчет и сохраняет в свою бд

